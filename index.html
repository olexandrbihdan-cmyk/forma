<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#b5845a">
  <title>Salon SHE ‚Äî –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #f7f5f2;
      --card: #ffffff;
      --accent: #b5845a;
      --accent-dark: #8c5e38;
      --text: #1a1a1a;
      --muted: #6b6b6b;
      --border: #d9d0c7;
      --error: #c0392b;
      --success: #27ae60;
      --radius: 12px;
      --shadow: 0 2px 12px rgba(0,0,0,0.08);
    }

    html, body {
      min-height: 100%;
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 16px;
      line-height: 1.5;
      -webkit-text-size-adjust: 100%;
    }

    .container {
      max-width: 520px;
      margin: 0 auto;
      padding: 16px 16px 40px;
    }

    .lang-switcher {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 16px;
    }
    .lang-btn {
      padding: 8px 16px;
      border: 1.5px solid var(--border);
      border-radius: 6px;
      background: var(--card);
      color: var(--muted);
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .lang-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }
    .lang-btn.active {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }

    .header {
      text-align: center;
      padding: 24px 0 20px;
    }
    .header h1 {
      font-size: 1.6rem;
      font-weight: 700;
      color: var(--accent-dark);
      letter-spacing: -0.5px;
    }
    .header p {
      color: var(--muted);
      font-size: 0.9rem;
      margin-top: 4px;
    }

    .card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px 16px;
      margin-bottom: 16px;
    }

    .section-title {
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--accent);
      margin-bottom: 14px;
    }

    .field {
      margin-bottom: 14px;
    }
    .field:last-child { margin-bottom: 0; }

    label {
      display: block;
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--muted);
      margin-bottom: 5px;
    }
    label .req { color: var(--error); margin-left: 2px; }

    input[type="text"],
    input[type="tel"],
    input[type="email"],
    input[type="datetime-local"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 13px 14px;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      font-size: 1rem;
      color: var(--text);
      background: #fff;
      appearance: none;
      -webkit-appearance: none;
      transition: border-color 0.2s;
      outline: none;
    }
    input:focus, select:focus, textarea:focus {
      border-color: var(--accent);
    }
    input.error, select.error, textarea.error {
      border-color: var(--error);
    }

    /* Hours stepper */
    .stepper {
      display: flex;
      align-items: center;
      gap: 0;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }
    .stepper button {
      width: 52px;
      height: 50px;
      background: var(--bg);
      border: none;
      font-size: 1.4rem;
      color: var(--accent-dark);
      cursor: pointer;
      flex-shrink: 0;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      transition: background 0.15s;
    }
    .stepper button:active { background: var(--border); }
    .stepper input {
      flex: 1;
      border: none;
      border-left: 1.5px solid var(--border);
      border-right: 1.5px solid var(--border);
      border-radius: 0;
      text-align: center;
      font-size: 1.1rem;
      font-weight: 700;
      padding: 13px 4px;
    }
    .stepper input:focus { border-color: var(--border); }

    /* Price block */
    .price-block {
      background: linear-gradient(135deg, #fdf6ee, #fbebd8);
      border: 1.5px solid #e8c99a;
      border-radius: var(--radius);
      padding: 16px;
      margin-bottom: 16px;
      text-align: center;
    }
    .price-label {
      font-size: 0.82rem;
      color: var(--muted);
      margin-bottom: 4px;
    }
    .price-amount {
      font-size: 2rem;
      font-weight: 800;
      color: var(--accent-dark);
      line-height: 1.1;
    }
    .price-amount span { font-size: 1.1rem; font-weight: 600; }
    .pay-btn {
      display: block;
      width: 100%;
      margin-top: 12px;
      padding: 13px;
      background: #1a1a2e;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      text-decoration: none;
      text-align: center;
      cursor: pointer;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      transition: opacity 0.2s;
    }
    .pay-btn:active { opacity: 0.8; }
    .pay-note {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 6px;
    }

    /* NIP conditional */
    #nip-row { display: none; }

    /* Checkboxes */
    .check-field {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 14px;
    }
    .check-field:last-child { margin-bottom: 0; }
    .check-field input[type="checkbox"] {
      width: 22px;
      height: 22px;
      min-width: 22px;
      margin-top: 1px;
      accent-color: var(--accent);
      cursor: pointer;
    }
    .check-field label {
      font-size: 0.88rem;
      font-weight: 400;
      color: var(--text);
      margin: 0;
      cursor: pointer;
    }
    .check-field label a {
      color: var(--accent);
      text-decoration: underline;
    }
    .check-field.error-check label { color: var(--error); }

    /* Signature */
    .sig-wrap {
      position: relative;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
      background: #fafafa;
    }
    .sig-wrap.error { border-color: var(--error); }
    #sigCanvas {
      display: block;
      width: 100%;
      cursor: crosshair;
    }
    .sig-hint {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #ccc;
      font-size: 0.85rem;
      pointer-events: none;
      text-align: center;
      line-height: 1.4;
    }
    .sig-actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 8px;
    }
    .btn-clear {
      background: none;
      border: 1.5px solid var(--border);
      border-radius: 6px;
      padding: 7px 14px;
      font-size: 0.82rem;
      color: var(--muted);
      cursor: pointer;
      touch-action: manipulation;
    }
    .btn-clear:active { background: var(--bg); }

    /* Submit */
    .btn-submit {
      display: block;
      width: 100%;
      padding: 17px;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: var(--radius);
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      transition: background 0.2s, opacity 0.2s;
      letter-spacing: 0.02em;
    }
    .btn-submit:active { background: var(--accent-dark); }
    .btn-submit:disabled { opacity: 0.6; cursor: not-allowed; }

    /* Messages */
    .msg {
      display: none;
      border-radius: var(--radius);
      padding: 16px;
      margin-bottom: 16px;
      font-size: 0.95rem;
      line-height: 1.5;
    }
    .msg.success {
      background: #eafaf1;
      border: 1.5px solid #a9dfbf;
      color: #1e8449;
    }
    .msg.error-msg {
      background: #fdedec;
      border: 1.5px solid #f1948a;
      color: var(--error);
    }
    .msg.pending {
      background: #fef9e7;
      border: 1.5px solid #f9e79f;
      color: #7d6608;
    }

    .field-error {
      font-size: 0.78rem;
      color: var(--error);
      margin-top: 4px;
      display: none;
    }

    /* Spinner */
    .spinner {
      display: inline-block;
      width: 18px;
      height: 18px;
      border: 2.5px solid rgba(255,255,255,0.4);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      vertical-align: middle;
      margin-right: 6px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    @media (min-width: 540px) {
      .container { padding: 24px 24px 60px; }
      .card { padding: 24px 20px; }
    }

  </style>
</head>
<body>
<div class="container">

  <!-- Language Switcher -->
  <div class="lang-switcher">
    <button type="button" class="lang-btn active" data-lang="ukr">üá∫üá¶ UKR</button>
    <button type="button" class="lang-btn" data-lang="pol">üáµüá± POL</button>
    <button type="button" class="lang-btn" data-lang="eng">üá¨üáß ENG</button>
  </div>

  <div class="header">
    <h1 data-i18n="title">Salon SHE</h1>
    <p data-i18n="subtitle">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –¥–æ—Å—Ç—É–ø—É –¥–æ –ª–æ–∫–∞–ª—É</p>
  </div>

  <!-- Status messages -->
  <div id="msg-success" class="msg success"></div>
  <div id="msg-error" class="msg error-msg"></div>
  <div id="msg-pending" class="msg pending"></div>

  <form id="mainForm" novalidate>

    <!-- Personal data -->
    <div class="card">
      <div class="section-title" data-i18n="section_personal">–û—Å–æ–±–∏—Å—Ç—ñ –¥–∞–Ω—ñ</div>

      <div class="field">
        <label for="fullName"><span data-i18n="label_fullname">–Ü–º'—è —Ç–∞ –ø—Ä—ñ–∑–≤–∏—â–µ</span> <span class="req">*</span></label>
        <input type="text" id="fullName" name="fullName" data-i18n-placeholder="placeholder_fullname" placeholder="–Ü–º'—è –ü—Ä—ñ–∑–≤–∏—â–µ" autocomplete="name" required>
        <div class="field-error" id="err-fullName" data-i18n="error_fullname">–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è —Ç–∞ –ø—Ä—ñ–∑–≤–∏—â–µ</div>
      </div>

      <div class="field">
        <label for="phone"><span data-i18n="label_phone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É</span> <span class="req">*</span></label>
        <input type="tel" id="phone" name="phone" placeholder="+48 000 000 000" autocomplete="tel" required>
        <div class="field-error" id="err-phone" data-i18n="error_phone">–í–≤–µ–¥—ñ—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É</div>
      </div>

      <div class="field">
        <label for="email"><span data-i18n="label_email">Email</span> <span class="req">*</span></label>
        <input type="email" id="email" name="email" placeholder="your@email.com" autocomplete="email" required>
        <div class="field-error" id="err-email" data-i18n="error_email">–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–∏–π email</div>
      </div>

      <div class="field">
        <label for="address"><span data-i18n="label_address">–ê–¥—Ä–µ—Å–∞</span> <span style="color:var(--muted);font-weight:400" data-i18n="optional">(–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)</span></label>
        <input type="text" id="address" name="address" data-i18n-placeholder="placeholder_address" placeholder="–í—É–ª–∏—Ü—è, –º—ñ—Å—Ç–æ" autocomplete="street-address">
      </div>
    </div>

        <!-- Documents -->
    <div class="card">
      <div class="section-title" data-i18n="section_documents">–î–æ–∫—É–º–µ–Ω—Ç–∏</div>

      <div class="field">
        <label for="idDoc"><span data-i18n="label_iddoc">–ù–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç—É</span> <span style="color:var(--muted);font-weight:400" data-i18n="optional">(–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)</span></label>
        <input type="text" id="idDoc" name="idDoc" data-i18n-placeholder="placeholder_iddoc" placeholder="–°–µ—Ä—ñ—è —Ç–∞ –Ω–æ–º–µ—Ä">
      </div>

      <div class="field">
        <div class="check-field" style="margin-bottom:10px">
          <input type="checkbox" id="invoiceRequested" name="invoiceRequested">
          <label for="invoiceRequested" data-i18n="label_invoice">–ü–æ—Ç—Ä—ñ–±–Ω–∞ —Ñ–∞–∫—Ç—É—Ä–∞ (faktura VAT)</label>
        </div>
      </div>

      <div class="field" id="nip-row">
        <label for="nip">NIP <span class="req">*</span></label>
        <input type="text" id="nip" name="nip" placeholder="000-000-00-00">
        <div class="field-error" id="err-nip" data-i18n="error_nip">NIP –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π –ø—Ä–∏ –∑–∞–ø–∏—Ç—ñ —Ñ–∞–∫—Ç—É—Ä–∏</div>
      </div>
    </div>

    <!-- Agreements -->
    <div class="card">
      <div class="section-title" data-i18n="section_agreements">–ó–≥–æ–¥–∏</div>

      <div class="check-field" id="wrap-regulamin">
        <input type="checkbox" id="acceptedRegulamin" name="acceptedRegulamin" required>
        <label for="acceptedRegulamin">
          <span data-i18n="label_regulamin">–Ø –æ–∑–Ω–∞–π–æ–º–∏–≤—Å—è/–æ–∑–Ω–∞–π–æ–º–∏–ª–∞—Å—å —ñ –ø—Ä–∏–π–º–∞—é</span>
          <a href="https://docs.google.com/document/d/1MCnRjH4PRL5NJkY6aZT0Nzeu8eBb2vVBOlFkzqlPT9M/edit?tab=t.0#heading=h.p4g7v9uedlgh"
             target="_blank" rel="noopener noreferrer">REGULAMIN</a>
          <span class="req">*</span>
        </label>
      </div>

      <div class="check-field" id="wrap-monitoring" style="margin-top:12px">
        <input type="checkbox" id="acceptedMonitoring" name="acceptedMonitoring" required>
        <label for="acceptedMonitoring">
          <span data-i18n="label_monitoring_before">–û–∑–Ω–∞–π–æ–º–∏–≤—Å—è/–æ–∑–Ω–∞–π–æ–º–∏–ª–∞—Å—å –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–æ—é –∫–ª–∞—É–∑—É–ª–æ—é</span>
          <a href="https://docs.google.com/document/d/1aCNh-sMQpxbYWWCQOr-Vu445tBQeCwmC0gLiwyZ8iAk/edit?tab=t.0" target="_blank" rel="noopener noreferrer">RODO</a>
          <span data-i18n="label_monitoring_after">—Ç–∞ –†–µ–≥–ª–∞–º–µ–Ω—Ç–æ–º —ñ –ø—Ä–∏–π–º–∞—é —ó—Ö –∑–º—ñ—Å—Ç</span>
          <span class="req">*</span>
        </label>
      </div>

      <div class="field-error" id="err-checks" style="display:none;margin-top:8px" data-i18n="error_checks">
        –ù–µ–æ–±—Ö—ñ–¥–Ω–æ –ø—Ä–∏–π–Ω—è—Ç–∏ –æ–±–∏–¥–≤—ñ –∑–≥–æ–¥–∏
      </div>
    </div>

    <!-- Signature -->
    <div class="card">
      <div class="section-title" data-i18n="section_signature">–ü—ñ–¥–ø–∏—Å</div>
      <div class="sig-wrap" id="sigWrap">
        <canvas id="sigCanvas" height="160"></canvas>
        <div class="sig-hint" id="sigHint" data-i18n="sig_hint">–ü—ñ–¥–ø–∏—à—ñ—Ç—å —Ç—É—Ç –ø–∞–ª—å—Ü–µ–º</div>
      </div>
      <div class="field-error" id="err-sig" style="margin-top:6px" data-i18n="error_signature">–ü—ñ–¥–ø–∏—Å –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π</div>
      <div class="sig-actions">
        <button type="button" class="btn-clear" id="btnClear" data-i18n="btn_clear">–û—á–∏—Å—Ç–∏—Ç–∏ –ø—ñ–¥–ø–∏—Å</button>
      </div>
    </div>

    <!-- Visit details -->
    <div class="card">
      <div class="section-title" data-i18n="section_visit">–î–µ—Ç–∞–ª—ñ –≤—ñ–∑–∏—Ç—É</div>

      <div class="field">
        <label for="visitDateTime"><span data-i18n="label_datetime">–î–∞—Ç–∞ —ñ —á–∞—Å –≤—ñ–∑–∏—Ç—É</span> <span class="req">*</span></label>
        <input type="datetime-local" id="visitDateTime" name="visitDateTime" required>
        <div class="field-error" id="err-visitDateTime" data-i18n="error_datetime">–û–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É —ñ —á–∞—Å</div>
      </div>

      <div class="field">
        <label for="hours"><span data-i18n="label_hours">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –≥–æ–¥–∏–Ω</span> <span class="req">*</span></label>
        <div class="stepper">
          <button type="button" id="btn-minus" data-i18n-aria="aria_decrease" aria-label="–ó–º–µ–Ω—à–∏—Ç–∏">‚àí</button>
          <input type="number" id="hours" name="hours" value="1" min="1" max="12" readonly>
          <button type="button" id="btn-plus" data-i18n-aria="aria_increase" aria-label="–ó–±—ñ–ª—å—à–∏—Ç–∏">+</button>
        </div>
        <div class="field-error" id="err-hours" data-i18n="error_hours">–û–±–µ—Ä—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≥–æ–¥–∏–Ω (1‚Äì12)</div>
      </div>
    </div>

    <!-- Price block -->
    <div class="price-block">
      <div class="price-label" data-i18n="price_label">Do zap≈Çaty</div>
      <div class="price-amount" id="priceDisplay">30 <span>PLN</span></div>
      <a id="payLink" href="#" target="_blank" rel="noopener noreferrer" class="pay-btn">
        <span data-i18n="btn_pay">üí≥ –û–ø–ª–∞—Ç–∏—Ç–∏</span>
      </a>
    </div>


    <!-- Submit -->
    <button type="submit" class="btn-submit" id="btnSubmit" data-i18n="btn_submit">
      –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ / Zatwierd≈∫
    </button>

  </form>
</div>

<script>
(function () {
  'use strict';

  /* ‚îÄ‚îÄ –í–ê–ñ–õ–ò–í–û: –≤—Å—Ç–∞–≤—Ç–µ —Å—é–¥–∏ URL –≤–∞—à–æ–≥–æ Apps Script doPost ‚îÄ‚îÄ */
  var APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzVQ70hrV6lH-bi9wM8gS2Ivs_j5bJxL1XXEpNLtPqu0zdgMnj9X7K77JYEfIB7VOw/exec';

  /* ‚îÄ‚îÄ Constants ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  var RATE_PER_HOUR    = 30;
  var REVOLUT_BASE     = 'https://revolut.me/bynya94';
  var PAYMENT_REQUIRED = false; // flip to true when live

  /* ‚îÄ‚îÄ Translations ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  var translations = {
    ukr: {
      title: 'Salon SHE',
      subtitle: '–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –¥–æ—Å—Ç—É–ø—É –¥–æ –ª–æ–∫–∞–ª—É',
      section_personal: '–û—Å–æ–±–∏—Å—Ç—ñ –¥–∞–Ω—ñ',
      label_fullname: '–Ü–º\'—è —Ç–∞ –ø—Ä—ñ–∑–≤–∏—â–µ',
      placeholder_fullname: '–Ü–º\'—è –ü—Ä—ñ–∑–≤–∏—â–µ',
      error_fullname: '–í–≤–µ–¥—ñ—Ç—å —ñ–º\'—è —Ç–∞ –ø—Ä—ñ–∑–≤–∏—â–µ',
      label_phone: '–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É',
      error_phone: '–í–≤–µ–¥—ñ—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É',
      label_email: 'Email',
      error_email: '–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–∏–π email',
      label_address: '–ê–¥—Ä–µ—Å–∞',
      optional: '(–Ω–µ–æ–±–æ–≤\'—è–∑–∫–æ–≤–æ)',
      placeholder_address: '–í—É–ª–∏—Ü—è, –º—ñ—Å—Ç–æ',
      section_visit: '–î–µ—Ç–∞–ª—ñ –≤—ñ–∑–∏—Ç—É',
      label_datetime: '–î–∞—Ç–∞ —ñ —á–∞—Å –≤—ñ–∑–∏—Ç—É',
      error_datetime: '–û–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É —ñ —á–∞—Å',
      label_hours: '–ö—ñ–ª—å–∫—ñ—Å—Ç—å –≥–æ–¥–∏–Ω',
      aria_decrease: '–ó–º–µ–Ω—à–∏—Ç–∏',
      aria_increase: '–ó–±—ñ–ª—å—à–∏—Ç–∏',
      error_hours: '–û–±–µ—Ä—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≥–æ–¥–∏–Ω (1‚Äì12)',
      price_label: '–î–æ —Å–ø–ª–∞—Ç–∏',
      btn_pay: 'üí≥ –û–ø–ª–∞—Ç–∏—Ç–∏',
      section_documents: '–î–æ–∫—É–º–µ–Ω—Ç–∏',
      label_iddoc: '–ù–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç—É –æ—Å–æ–±–∏ (–∞–±–æ PESEL)',
      placeholder_iddoc: '–°–µ—Ä—ñ—è —Ç–∞ –Ω–æ–º–µ—Ä –∞–±–æ PESEL',
      label_invoice: '–ü–æ—Ç—Ä—ñ–±–Ω–∞ —Ñ–∞–∫—Ç—É—Ä–∞ (faktura VAT)',
      error_nip: 'NIP –æ–±–æ–≤\'—è–∑–∫–æ–≤–∏–π –ø—Ä–∏ –∑–∞–ø–∏—Ç—ñ —Ñ–∞–∫—Ç—É—Ä–∏',
      section_agreements: '–ó–≥–æ–¥–∏',
      label_regulamin: '–Ø –æ–∑–Ω–∞–π–æ–º–∏–≤—Å—è/–æ–∑–Ω–∞–π–æ–º–∏–ª–∞—Å—å —ñ –ø—Ä–∏–π–º–∞—é',
      label_monitoring_before: '–û–∑–Ω–∞–π–æ–º–∏–≤—Å—è/–æ–∑–Ω–∞–π–æ–º–∏–ª–∞—Å—å –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–æ—é –∫–ª–∞—É–∑—É–ª–æ—é',
      label_monitoring_after: '—Ç–∞ –†–µ–≥–ª–∞–º–µ–Ω—Ç–æ–º —ñ –ø—Ä–∏–π–º–∞—é —ó—Ö –∑–º—ñ—Å—Ç',
      error_checks: '–ù–µ–æ–±—Ö—ñ–¥–Ω–æ –ø—Ä–∏–π–Ω—è—Ç–∏ –æ–±–∏–¥–≤—ñ –∑–≥–æ–¥–∏',
      section_signature: '–ü—ñ–¥–ø–∏—Å',
      sig_hint: '–ü—ñ–¥–ø–∏—à—ñ—Ç—å —Ç—É—Ç –ø–∞–ª—å—Ü–µ–º',
      error_signature: '–ü—ñ–¥–ø–∏—Å –æ–±–æ–≤\'—è–∑–∫–æ–≤–∏–π',
      btn_clear: '–û—á–∏—Å—Ç–∏—Ç–∏ –ø—ñ–¥–ø–∏—Å',
      btn_submit: '–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏'
    },
    pol: {
      title: 'Salon SHE',
      subtitle: 'Rejestracja dostƒôpu do lokalu',
      section_personal: 'Dane osobowe',
      label_fullname: 'Imiƒô i nazwisko',
      placeholder_fullname: 'Imiƒô Nazwisko',
      error_fullname: 'Wprowad≈∫ imiƒô i nazwisko',
      label_phone: 'Numer telefonu',
      error_phone: 'Wprowad≈∫ numer telefonu',
      label_email: 'Email',
      error_email: 'Wprowad≈∫ poprawny email',
      label_address: 'Adres',
      optional: '(opcjonalnie)',
      placeholder_address: 'Ulica, miasto',
      section_visit: 'Szczeg√≥≈Çy wizyty',
      label_datetime: 'Data i godzina wizyty',
      error_datetime: 'Wybierz datƒô i godzinƒô',
      label_hours: 'Liczba godzin',
      aria_decrease: 'Zmniejsz',
      aria_increase: 'Zwiƒôksz',
      error_hours: 'Wybierz liczbƒô godzin (1‚Äì12)',
      price_label: 'Do zap≈Çaty',
      btn_pay: 'üí≥ Zap≈Çaƒá',
      section_documents: 'Dokumenty',
      label_iddoc: 'Numer dokumentu to≈ºsamo≈õci (lub PESEL)',
      placeholder_iddoc: 'Seria i numer lub PESEL',
      label_invoice: 'Potrzebujƒô faktury (faktura VAT)',
      error_nip: 'NIP wymagany przy ≈ºƒÖdaniu faktury',
      section_agreements: 'Zgody',
      label_regulamin: 'Zapozna≈Çem/Zapozna≈Çam siƒô i akceptujƒô',
      label_monitoring_before: 'Zapozna≈Çem/am siƒô z klauzulƒÖ informacyjnƒÖ',
      label_monitoring_after: 'oraz Regulaminem i akceptujƒô ich tre≈õƒá',
      error_checks: 'Nale≈ºy zaakceptowaƒá obie zgody',
      section_signature: 'Podpis',
      sig_hint: 'Podpisz tutaj palcem',
      error_signature: 'Podpis wymagany',
      btn_clear: 'Wyczy≈õƒá podpis',
      btn_submit: 'Zatwierd≈∫'
    },
    eng: {
      title: 'Salon SHE',
      subtitle: 'Location access registration',
      section_personal: 'Personal data',
      label_fullname: 'Full name',
      placeholder_fullname: 'First Last',
      error_fullname: 'Enter your full name',
      label_phone: 'Phone number',
      error_phone: 'Enter phone number',
      label_email: 'Email',
      error_email: 'Enter valid email',
      label_address: 'Address',
      optional: '(optional)',
      placeholder_address: 'Street, city',
      section_visit: 'Visit details',
      label_datetime: 'Visit date and time',
      error_datetime: 'Select date and time',
      label_hours: 'Number of hours',
      aria_decrease: 'Decrease',
      aria_increase: 'Increase',
      error_hours: 'Select number of hours (1‚Äì12)',
      price_label: 'To pay',
      btn_pay: 'üí≥ Pay',
      section_documents: 'Documents',
      label_iddoc: 'ID document number (or PESEL)',
      placeholder_iddoc: 'Series and number or PESEL',
      label_invoice: 'I need an invoice (faktura VAT)',
      error_nip: 'NIP required when requesting invoice',
      section_agreements: 'Agreements',
      label_regulamin: 'I have read and accept',
      label_monitoring_before: 'I have read the',
      label_monitoring_after: 'information clause and the Regulations and accept their content',
      error_checks: 'Both consents must be accepted',
      section_signature: 'Signature',
      sig_hint: 'Sign here with your finger',
      error_signature: 'Signature required',
      btn_clear: 'Clear signature',
      btn_submit: 'Submit'
    }
  };

  var currentLang = 'ukr';

  function setLanguage(lang) {
    currentLang = lang;
    var t = translations[lang];
    
    // Update all elements with data-i18n
    document.querySelectorAll('[data-i18n]').forEach(function(el) {
      var key = el.getAttribute('data-i18n');
      if (t[key]) el.textContent = t[key];
    });
    
    // Update placeholders
    document.querySelectorAll('[data-i18n-placeholder]').forEach(function(el) {
      var key = el.getAttribute('data-i18n-placeholder');
      if (t[key]) el.placeholder = t[key];
    });
    
    // Update aria-labels
    document.querySelectorAll('[data-i18n-aria]').forEach(function(el) {
      var key = el.getAttribute('data-i18n-aria');
      if (t[key]) el.setAttribute('aria-label', t[key]);
    });
    
    // Update active button
    document.querySelectorAll('.lang-btn').forEach(function(btn) {
      btn.classList.remove('active');
      if (btn.getAttribute('data-lang') === lang) {
        btn.classList.add('active');
      }
    });
    
    // Save to localStorage
    localStorage.setItem('salon_she_lang', lang);
  }

  // Language switcher
  document.querySelectorAll('.lang-btn').forEach(function(btn) {
    btn.addEventListener('click', function() {
      setLanguage(this.getAttribute('data-lang'));
    });
  });

  // Load saved language or default to ukr
  var savedLang = localStorage.getItem('salon_she_lang') || 'ukr';
  setLanguage(savedLang);

  /* ‚îÄ‚îÄ Price & Revolut link ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  var hoursInput   = document.getElementById('hours');
  var priceDisplay = document.getElementById('priceDisplay');
  var payLink      = document.getElementById('payLink');

  function updatePrice() {
    var h     = parseInt(hoursInput.value, 10) || 1;
    var total = h * RATE_PER_HOUR;
    priceDisplay.innerHTML = total + ' <span>PLN</span>';
    var revolutUrl = REVOLUT_BASE + '?currency=PLN&amount=' + (total * 100);
    payLink.href = revolutUrl;
  }

  document.getElementById('btn-minus').addEventListener('click', function () {
    var v = parseInt(hoursInput.value, 10);
    if (v > 1) { hoursInput.value = v - 1; updatePrice(); }
  });
  document.getElementById('btn-plus').addEventListener('click', function () {
    var v = parseInt(hoursInput.value, 10);
    if (v < 12) { hoursInput.value = v + 1; updatePrice(); }
  });
  updatePrice();

  /* ‚îÄ‚îÄ NIP toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  var invoiceCheck = document.getElementById('invoiceRequested');
  var nipRow       = document.getElementById('nip-row');
  var nipInput     = document.getElementById('nip');
  invoiceCheck.addEventListener('change', function () {
    nipRow.style.display = this.checked ? 'block' : 'none';
    if (!this.checked) { nipInput.value = ''; clearErr(nipInput, 'err-nip'); }
  });

  /* ‚îÄ‚îÄ Signature pad ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  var canvas  = document.getElementById('sigCanvas');
  var ctx     = canvas.getContext('2d');
  var sigWrap = document.getElementById('sigWrap');
  var sigHint = document.getElementById('sigHint');
  var drawing = false;
  var hasSig  = false;

  function resizeCanvas() {
    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø—ñ–¥–ø–∏—Å –ø–µ—Ä–µ–¥ resize
    var imgData = hasSig ? canvas.toDataURL() : null;
    
    var w     = sigWrap.offsetWidth;
    var ratio = window.devicePixelRatio || 1;
    canvas.width        = w * ratio;
    canvas.height       = 160 * ratio;
    canvas.style.width  = w + 'px';
    canvas.style.height = '160px';
    ctx.scale(ratio, ratio);
    ctx.strokeStyle = '#1a1a1a';
    ctx.lineWidth   = 2;
    ctx.lineCap     = 'round';
    ctx.lineJoin    = 'round';
    
    // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –ø—ñ–¥–ø–∏—Å –ø—ñ—Å–ª—è resize
    if (imgData) {
      var img = new Image();
      img.onload = function() {
        ctx.drawImage(img, 0, 0, w, 160);
      };
      img.src = imgData;
    } else {
      hasSig = false;
      sigHint.style.display = 'block';
    }
  }
  resizeCanvas();
  
  // Debounce resize —â–æ–± –Ω–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –∑–∞–Ω–∞–¥—Ç–æ —á–∞—Å—Ç–æ
  var resizeTimeout;
  window.addEventListener('resize', function() {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(resizeCanvas, 100);
  });

  function getPos(e) {
    var rect = canvas.getBoundingClientRect();
    var src  = e.touches ? e.touches[0] : e;
    return { x: src.clientX - rect.left, y: src.clientY - rect.top };
  }

  function startDraw(e) {
    e.preventDefault();
    drawing = true;
    var p = getPos(e);
    ctx.beginPath();
    ctx.moveTo(p.x, p.y);
    sigHint.style.display = 'none';
    hasSig = true;
    clearErr(null, 'err-sig');
    sigWrap.classList.remove('error');
  }
  function draw(e) {
    if (!drawing) return;
    var p = getPos(e);
    ctx.lineTo(p.x, p.y);
    ctx.stroke();
  }
  function endDraw(e) {
    if (drawing) { e.preventDefault(); drawing = false; }
  }

  canvas.addEventListener('mousedown',  startDraw);
  canvas.addEventListener('mousemove',  draw);
  canvas.addEventListener('mouseup',    endDraw);
  canvas.addEventListener('mouseleave', endDraw);
  canvas.addEventListener('touchstart', startDraw, { passive: false });
  canvas.addEventListener('touchmove',  function (e) {
    if (drawing) { e.preventDefault(); }
    draw(e);
  }, { passive: false });
  canvas.addEventListener('touchend', endDraw, { passive: false });

  document.getElementById('btnClear').addEventListener('click', function () {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    hasSig = false;
    sigHint.style.display = 'block';
  });

  /* ‚îÄ‚îÄ Validation helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function showErr(el, errId, msg) {
    if (el) el.classList.add('error');
    var errEl = document.getElementById(errId);
    if (errEl) { if (msg) errEl.textContent = msg; errEl.style.display = 'block'; }
  }
  function clearErr(el, errId) {
    if (el) el.classList.remove('error');
    var errEl = document.getElementById(errId);
    if (errEl) errEl.style.display = 'none';
  }
  function isValidEmail(v) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
  }

  /* ‚îÄ‚îÄ Form submit ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  document.getElementById('mainForm').addEventListener('submit', function (e) {
    e.preventDefault();
    var valid = true;

    ['fullName','phone','email','visitDateTime','hours','nip'].forEach(function (id) {
      clearErr(document.getElementById(id), 'err-' + id);
    });
    clearErr(null, 'err-checks');
    clearErr(null, 'err-sig');
    sigWrap.classList.remove('error');
    document.getElementById('wrap-regulamin').classList.remove('error-check');
    document.getElementById('wrap-monitoring').classList.remove('error-check');

    var fullName      = document.getElementById('fullName').value.trim();
    var phone         = document.getElementById('phone').value.trim();
    var email         = document.getElementById('email').value.trim();
    var address       = document.getElementById('address').value.trim();
    var visitDateTime = document.getElementById('visitDateTime').value;
    var hours         = parseInt(hoursInput.value, 10);
    var idDoc         = document.getElementById('idDoc').value.trim();
    var nip           = nipInput.value.trim();
    var invoice       = invoiceCheck.checked;
    var regCheck      = document.getElementById('acceptedRegulamin').checked;
    var monCheck      = document.getElementById('acceptedMonitoring').checked;

    if (!fullName) { showErr(document.getElementById('fullName'), 'err-fullName'); valid = false; }
    if (!phone)    { showErr(document.getElementById('phone'),    'err-phone');    valid = false; }
    if (!email || !isValidEmail(email)) { showErr(document.getElementById('email'), 'err-email'); valid = false; }
    if (!visitDateTime) { showErr(document.getElementById('visitDateTime'), 'err-visitDateTime'); valid = false; }
    if (!hours || hours < 1 || hours > 12) { showErr(hoursInput, 'err-hours'); valid = false; }
    if (invoice && !nip) { showErr(nipInput, 'err-nip'); valid = false; }
    if (!regCheck || !monCheck) {
      document.getElementById('err-checks').style.display = 'block';
      if (!regCheck) document.getElementById('wrap-regulamin').classList.add('error-check');
      if (!monCheck) document.getElementById('wrap-monitoring').classList.add('error-check');
      valid = false;
    }
    if (!hasSig) {
      document.getElementById('err-sig').style.display = 'block';
      sigWrap.classList.add('error');
      valid = false;
    }

    if (!valid) {
      var firstErr = document.querySelector('.error, .error-check');
      if (firstErr) firstErr.scrollIntoView({ behavior: 'smooth', block: 'center' });
      return;
    }

    /* Build payload */
    var amountPLN   = hours * RATE_PER_HOUR;
    var revolutLink = REVOLUT_BASE + '?currency=PLN&amount=' + (amountPLN * 100);
    var sigBase64   = canvas.toDataURL('image/png');

    // Format visitDateTime to DD.MM.YYYY HH:mm
    var visitFormatted = visitDateTime;
    if (visitDateTime) {
      var dt = new Date(visitDateTime);
      var dd = ('0' + dt.getDate()).slice(-2);
      var mm = ('0' + (dt.getMonth() + 1)).slice(-2);
      var yyyy = dt.getFullYear();
      var hh = ('0' + dt.getHours()).slice(-2);
      var min = ('0' + dt.getMinutes()).slice(-2);
      visitFormatted = dd + '.' + mm + '.' + yyyy + ' ' + hh + ':' + min;
    }

    var payload = {
      fullName:            fullName,
      phone:               phone,
      email:               email,
      address:             address,
      visitDateTime:       visitFormatted,
      hours:               hours,
      idDoc:               idDoc,
      nip:                 nip,
      invoiceRequested:    invoice,
      acceptedRegulamin:   regCheck,
      acceptedMonitoring:  monCheck,
      signatureBase64:     sigBase64,
      calculatedAmountPLN: amountPLN,
      revolutLink:         revolutLink,
      payment_status:      PAYMENT_REQUIRED ? 'PENDING' : 'SKIPPED',
      payment_reference:   ''
    };

    /* UI: loading */
    var btn = document.getElementById('btnSubmit');
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner"></span>–í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ‚Ä¶';
    hideMessages();

    /* ‚îÄ‚îÄ fetch() ‚Üí Apps Script doPost ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    fetch(APPS_SCRIPT_URL, {
      method:  'POST',
      headers: { 'Content-Type': 'text/plain' }, // text/plain avoids CORS preflight
      body:    JSON.stringify(payload)
    })
    .then(function (response) {
      if (!response.ok) { throw new Error('HTTP ' + response.status); }
      return response.json();
    })
    .then(function (result) {
      resetBtn();
      hideMessages();
      if (result && result.paymentPending) {
        showMsg('msg-pending', '‚è≥ –û—á—ñ–∫—É—î–º–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –æ–ø–ª–∞—Ç–∏. –î–æ–≥–æ–≤—ñ—Ä –±—É–¥–µ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –ø—ñ—Å–ª—è –æ–ø–ª–∞—Ç–∏.');
      } else {
        showMsg('msg-success', '‚úÖ –î–æ–≥–æ–≤—ñ—Ä –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ email: ' + email +
          (result && result.message ? '\n' + result.message : ''));
        document.getElementById('mainForm').reset();
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        hasSig = false;
        sigHint.style.display = 'block';
        nipRow.style.display  = 'none';
        updatePrice();
      }
      window.scrollTo({ top: 0, behavior: 'smooth' });
    })
    .catch(function (err) {
      resetBtn();
      showMsg('msg-error', '‚ùå –ü–æ–º–∏–ª–∫–∞: ' + (err && err.message ? err.message : String(err)));
    });
  });

  /* ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function resetBtn() {
    var btn = document.getElementById('btnSubmit');
    btn.disabled  = false;
    btn.innerHTML = '–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ / Zatwierd≈∫';
  }
  function hideMessages() {
    ['msg-success', 'msg-error', 'msg-pending'].forEach(function (id) {
      document.getElementById(id).style.display = 'none';
    });
  }
  function showMsg(id, text) {
    var el = document.getElementById(id);
    el.textContent  = text;
    el.style.display = 'block';
  }

})();
</script>
</body>
</html>
